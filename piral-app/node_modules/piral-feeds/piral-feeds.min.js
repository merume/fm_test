var piralFeeds=(()=>{var k=Object.create;var F=Object.defineProperty,L=Object.defineProperties,$=Object.getOwnPropertyDescriptor,q=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertyNames,x=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var w=(t,e,r)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,s=(t,e)=>{for(var r in e||(e={}))R.call(e,r)&&w(t,r,e[r]);if(x)for(var r of x(e))J.call(e,r)&&w(t,r,e[r]);return t},c=(t,e)=>L(t,q(e)),S=t=>F(t,"__esModule",{value:!0});var l=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(e,r)=>(typeof require!="undefined"?require:e)[r]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var G=(t,e)=>{S(t);for(var r in e)F(t,r,{get:e[r],enumerable:!0})},M=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of B(e))!R.call(t,o)&&o!=="default"&&F(t,o,{get:()=>e[o],enumerable:!(r=$(e,o))||r.enumerable});return t},u=t=>M(S(F(t!=null?k(H(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Y={};G(Y,{createFeedsApi:()=>X,useFeed:()=>h,withFeed:()=>I});var g={};G(g,{createFeed:()=>Q,destroyFeed:()=>U,loadFeed:()=>W,loadedFeed:()=>m,updateFeed:()=>A});var p=u(l("piral-core"));function Q(t,e){t.dispatch(r=>c(s({},r),{feeds:(0,p.withKey)(r.feeds,e,{data:void 0,error:void 0,loaded:!1,loading:!1})}))}function U(t,e){t.dispatch(r=>c(s({},r),{feeds:(0,p.withoutKey)(r.feeds,e)}))}function W(t,e){let{id:r}=e;return t.dispatch(o=>c(s({},o),{feeds:(0,p.withKey)(o.feeds,r,{data:void 0,error:void 0,loaded:!1,loading:!0})})),e.initialize().then(o=>{m(t,r,o,void 0),e.dispose=e.connect(n=>{A(t,r,n,e.update)})},o=>m(t,r,void 0,o))}function m(t,e,r,o){t.dispatch(n=>c(s({},n),{feeds:(0,p.withKey)(n.feeds,e,{loading:!1,loaded:!0,error:o,data:r})}))}function A(t,e,r,o){let n=t.readState(a=>a.feeds[e]),i=o(n.data,r);if(i instanceof Promise)return i.then(a=>m(t,e,a,void 0)).catch(a=>m(t,e,void 0,a));i!==n.data&&m(t,e,i,void 0)}var N=u(l("piral-core"));var y=u(l("react")),D=u(l("piral-core"));var O=u(l("react")),C=u(l("piral-core"));function h(t){let{loaded:e,loading:r,error:o,data:n}=(0,C.useGlobalState)(a=>a.feeds[t.id]),i=(0,C.useAction)("loadFeed");return(0,O.useEffect)(()=>{!e&&!r&&i(t)},[e]),[e,n,o]}function I(t,e){let r=o=>{let[n,i,a]=h(e);return n?i?y.createElement(t,c(s({},o),{data:i})):y.createElement(D.RegisteredErrorInfo,{type:"feed",error:a}):y.createElement(D.RegisteredLoadingIndicator,null)};return r.displayName=`FeedView_${e.id}`,r}var z=u(l("piral-core")),E=()=>{};function K(t,e){return(0,z.isfunc)(e)?{id:t,initialize(){return e()},connect(){return E},update(r){return Promise.resolve(r)},immediately:!1,reducers:{}}:{id:t,initialize(){return e.initialize()},connect(r){return typeof e.connect=="function"?e.connect(r):E},update(r,o){return typeof e.update=="function"?e.update(r,o):Promise.resolve(r)},immediately:e.immediately,reducers:e.reducers||{}}}function X(t={}){return e=>(e.defineActions(g),e.dispatch(r=>c(s({},r),{feeds:{}})),(r,o)=>{let n=0;return{createConnector(i){let a=(0,N.buildName)(o.name,n++),d=K(a,i),P=()=>{var f;(f=d.dispose)==null||f.call(d),e.createFeed(d.id)};d.immediately?e.loadFeed(d):P();let T=f=>I(f,d);return Object.keys(d.reducers).forEach(f=>{let b=d.reducers[f];typeof b=="function"&&(T[f]=(...V)=>{e.updateFeed(a,V,(_,j)=>b.call(T,_,...j))})}),T.invalidate=P,T}}})}return Y;})();
