"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const utils_1 = require("../../utils");
function extendSharedDependencies(dependencies) {
    for (const name of Object.keys(dependencies)) {
        if (!System.has(name)) {
            const dependency = dependencies[name];
            (0, utils_1.registerModule)(name, () => System.import(dependency));
        }
    }
}
function handleFailure(error, link) {
    console.error('Failed to load SystemJS module', link, error);
    return utils_1.emptyApp;
}
/**
 * Loads the provided SystemJS-powered pilet.
 * @param entry The pilet's entry.
 * @param _config The loader configuration.
 * @returns The evaluated pilet that can now be integrated.
 */
function loader(entry, _config) {
    const { dependencies = {}, config = {}, link } = entry, rest = tslib_1.__rest(entry, ["dependencies", "config", "link"]);
    const meta = Object.assign({ dependencies,
        config,
        link }, rest);
    extendSharedDependencies(dependencies);
    return System.import(link)
        .catch((error) => handleFailure(error, link))
        .then((app) => (0, utils_1.createEvaluatedPilet)(meta, app));
}
exports.default = loader;
//# sourceMappingURL=index.js.map