"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fetch_1 = require("./fetch");
const dependency_1 = require("./dependency");
const utils_1 = require("../../utils");
/**
 * Loads a legacy (v0) or invalid pilet.
 * @param entry The pilet's entry.
 * @param _config The loader configuration.
 * @returns The evaluated pilet that can now be integrated.
 */
function loader(entry, _config) {
    const { name, config = {}, dependencies = {}, spec = 'v0' } = entry;
    const meta = Object.assign({ name,
        config,
        dependencies,
        spec, link: '' }, entry);
    if ('link' in entry && entry.link) {
        return (0, utils_1.loadFrom)(meta, () => (0, fetch_1.fetchDependency)(entry.link).then((content) => (0, dependency_1.evalDependency)(name, content, entry.link)));
    }
    else {
        const content = ('content' in entry && entry.content) || '';
        return (0, utils_1.loadFrom)(meta, () => (0, dependency_1.evalDependency)(name, content, undefined));
    }
}
exports.default = loader;
//# sourceMappingURL=index.js.map