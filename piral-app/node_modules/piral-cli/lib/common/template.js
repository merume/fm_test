"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createPiralStubIndexIfNotExists = void 0;
const io_1 = require("./io");
function fillTemplate(data = {}) {
    return `if (process.env.NODE_ENV === 'test') {
  // behavior for the test environment, we'll try to make it work

  if (typeof window !== 'undefined') {
    require('./${data.outFile}');
    const ctx = window['dbg:piral'];
    const dependencies = (ctx && ctx.pilets && ctx.pilets.getDependencies({})) || {};
    module.exports = dependencies['${data.name}'] || {};
  } else {
    console.error('Your test environment does not define "window". Please make sure to provide a proper environment.');
    module.exports = {};
  }
} else {
  // under "normal" circumstances disallow such an import
  throw new Error("This file should not be included anywhere. Usually, this means you've imported the Piral instance directly.");
}
`;
}
function createPiralStubIndexIfNotExists(targetDir, fileName, forceOverwrite, data) {
    return __awaiter(this, void 0, void 0, function* () {
        const content = fillTemplate(data);
        yield (0, io_1.createFileIfNotExists)(targetDir, fileName, content, forceOverwrite);
    });
}
exports.createPiralStubIndexIfNotExists = createPiralStubIndexIfNotExists;
//# sourceMappingURL=template.js.map