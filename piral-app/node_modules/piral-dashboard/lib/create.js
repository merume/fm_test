"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createDashboardApi = void 0;
const actions = require("./actions");
const piral_core_1 = require("piral-core");
const Dashboard_1 = require("./Dashboard");
const helpers_1 = require("./helpers");
/**
 * Creates the Pilet API extension for activating dashboard support.
 */
function createDashboardApi(config = {}) {
    const { tiles = [], defaultPreferences = {}, routes = ['/'] } = config;
    return (context) => {
        context.defineActions(actions);
        context.dispatch((0, piral_core_1.withAll)((0, helpers_1.withTiles)((0, helpers_1.getTiles)(tiles, defaultPreferences)), (0, piral_core_1.withRootExtension)('piral-dashboard', Dashboard_1.Dashboard), (0, helpers_1.withRoutes)(routes)));
        return (api, target) => {
            const pilet = target.name;
            let next = 0;
            return {
                registerTile(name, arg, preferences) {
                    if (typeof name !== 'string') {
                        preferences = arg;
                        arg = name;
                        name = next++;
                    }
                    const id = (0, piral_core_1.buildName)(pilet, name);
                    context.registerTile(id, {
                        pilet,
                        component: (0, piral_core_1.withApi)(context, arg, api, 'tile'),
                        preferences: (0, helpers_1.getPreferences)(defaultPreferences, preferences),
                    });
                    return () => api.unregisterTile(name);
                },
                unregisterTile(name) {
                    const id = (0, piral_core_1.buildName)(pilet, name);
                    context.unregisterTile(id);
                },
            };
        };
    };
}
exports.createDashboardApi = createDashboardApi;
//# sourceMappingURL=create.js.map